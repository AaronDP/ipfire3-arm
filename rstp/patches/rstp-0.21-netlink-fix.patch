From 434d24bae108dbb21461a13a4abcf014afa8b029 Mon Sep 17 00:00:00 2001
From: Stephen Hemminger <shemminger@vyatta.com>
Date: Tue, 11 Oct 2011 16:07:27 -0700
Subject: [PATCH] fix bridge port state in netlink message

The IFLA_PROTINFO is a u8 not u32, and sending a bigger value
to kernel means extra bytes are ignored, leaving state as always 0.
---
 brstate.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/brstate.c b/brstate.c
index 1fe792e..889c2ea 100644
--- a/brstate.c
+++ b/brstate.c
@@ -42,7 +42,7 @@ static int br_set_state(struct rtnl_handle *rth, unsigned ifindex, __u8 state)
 	req.ifi.ifi_family = AF_BRIDGE;
 	req.ifi.ifi_index = ifindex;
 
-	addattr32(&req.n, sizeof(req.buf), IFLA_PROTINFO, state);
+	addattr_l(&req.n, sizeof(req.buf), IFLA_PROTINFO, &state, sizeof(state));
 
 	return rtnl_talk(rth, &req.n, 0, 0, NULL, NULL, NULL);
 }
-- 
1.7.6.2

