diff -Nur a/src/gui/kernel/qdnd_x11.cpp b/src/gui/kernel/qdnd_x11.cpp
--- a/src/gui/kernel/qdnd_x11.cpp	2012-03-14 15:01:16.000000000 +0100
+++ b/src/gui/kernel/qdnd_x11.cpp	2012-05-20 17:19:38.992247206 +0200
@@ -1422,6 +1422,7 @@
     global_accepted_action = Qt::IgnoreAction;
 }
 
+#ifndef QT_NO_SHAPE
 static
 bool windowInteractsWithPosition(const QPoint & pos, Window w, int shapeType)
 {
@@ -1436,6 +1437,7 @@
     }
     return interacts;
 }
+#endif
 
 static
 Window findRealWindow(const QPoint & pos, Window w, int md)
@@ -1462,6 +1464,8 @@
                 XGetWindowProperty(X11->display, w, ATOM(XdndAware), 0, 0, False,
                                    AnyPropertyType, &type, &f,&n,&a,&data);
                 if (data) XFree(data);
+
+#ifndef QT_NO_SHAPE
                 if (type) {
                     // When ShapeInput and ShapeBounding are not set they return a single rectangle with the geometry of the window, this is why we
                     // need an && here so that in the case one is set and the other is not we still get the correct result.
@@ -1469,6 +1473,9 @@
                     if (windowContainsMouse)
                         return w;
                 }
+#else
+		return w;
+#endif
             }
 
             Window r, p;
@@ -1488,10 +1495,12 @@
                 // innermost window.
             }
 
+#ifndef QT_NO_SHAPE
             // No children!
             if (!windowContainsMouse)
                 return 0;
             else
+#endif
                 return w;
         }
     }
