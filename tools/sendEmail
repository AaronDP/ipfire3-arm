#!/usr/bin/python

import os
import smtplib

try:
	server = "%s" % os.environ["MAIL_SERVER"]
except KeyError:
	server = "mail01.tremer.info"

try:
	toaddrs = "To: %s" % os.environ["MAIL_TO"]
except KeyError:
	toaddrs = "To: developers@ipfire.org"

try:
	fromaddr = "From: %s" % os.environ["MAIL_FROM"]
except KeyError:
	fromaddr = "From: build@ipfire.org"

try:
	subject = "Subject: %s" % os.environ["MAIL_SUBJECT"]
except KeyError:
	subject = "Subject: No subject given"

auth=True
try:
	user     = os.environ["MAIL_USER"]
	password = os.environ["MAIL_PASS"]
except KeyError:
	auth=False

body = header = ""
while 1:
	try:
		line = raw_input()
	except EOFError:
		break
	body = body + line + "\r\n"

for i in fromaddr, toaddrs, subject:
	header = header + i + "\r\n"
	
msg = header + "\r\n" + body # An empty line to finish the header + add the body

server = smtplib.SMTP(server)
#server.set_debuglevel(1)
if auth:
	server.login(user, password)

server.sendmail(fromaddr, toaddrs, msg)
server.quit()
