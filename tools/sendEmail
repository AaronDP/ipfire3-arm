#!/usr/bin/python

import os
import smtplib

from email.MIMEMultipart import MIMEMultipart
from email.MIMEText import MIMEText
#from email.MIMEImage import MIMEImage

try:
	server = "%s" % os.environ["MAIL_SERVER"]
except KeyError:
	server = "mail01.tremer.info"

try:
	toaddrs = "%s" % os.environ["MAIL_TO"]
except KeyError:
	toaddrs = "developers@ipfire.org"

try:
	fromaddr = "%s" % os.environ["MAIL_FROM"]
except KeyError:
	fromaddr = "build@ipfire.org"

try:
	subject = "%s" % os.environ["MAIL_SUBJECT"]
except KeyError:
	subject = "No subject given"

auth=True
try:
	user     = os.environ["MAIL_USER"]
	password = os.environ["MAIL_PASS"]
except KeyError:
	auth=False

text = ""
while 1:
	try:
		line = raw_input()
	except EOFError:
		break
	text += line + "\r\n"

# Create message
msg = MIMEMultipart('related')
msg['Subject'] = subject
msg['From'] = fromaddr
msg['To'] = toaddrs
msg.preamble = 'This is a multi-part message in MIME format.'

msg.attach(MIMEText(text, 'html'))

server = smtplib.SMTP(server)
#server.set_debuglevel(1)
if auth:
	server.login(user, password)

server.sendmail(fromaddr, toaddrs.split(", "), msg.as_string())
server.quit()
