#!/bin/bash
###############################################################################
#                                                                             #
# IPFire.org - A linux based firewall                                         #
# Copyright (C) 2007  Michael Tremer & Christian Schmidt                      #
#                                                                             #
# This program is free software: you can redistribute it and/or modify        #
# it under the terms of the GNU General Public License as published by        #
# the Free Software Foundation, either version 3 of the License, or           #
# (at your option) any later version.                                         #
#                                                                             #
# This program is distributed in the hope that it will be useful,             #
# but WITHOUT ANY WARRANTY; without even the implied warranty of              #
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the               #
# GNU General Public License for more details.                                #
#                                                                             #
# You should have received a copy of the GNU General Public License           #
# along with this program.  If not, see <http://www.gnu.org/licenses/>.       #
#                                                                             #
###############################################################################
###############################################################################
#
# A small helper to make the svn functions comfortable
#
###############################################################################

svn_up() {
	echo "Loading the latest source files..."
	if [ "$3" ]; then
		svn update -r $3
	else
		svn update
	fi
	if [ $? -eq "0" ]; then
		beautify message DONE
	else
		beautify message FAIL
		exit 1
	fi
}

svn_commit() {
	if which nano; then
		export EDITOR=nano
	fi
	if [ "`echo $SVN_REVISION | cut -c 3`" -eq "0" ]; then
		svn_changelog
	fi
	update_langs
	svn commit
}

svn_diff(){
	echo -ne "Make a local diff to last svn revision"
	svn diff > ipfire-diff-`date +'%Y-%m-%d-%H:%M'`-r`svn info | grep Revision | cut -c 11-`.diff
	evaluate 1
	echo "Diff was successfully saved to ipfire-diff-`date +'%Y-%m-%d-%H:%M'`-r`svn info | grep Revision | cut -c 11-`.diff"
	svn status
}

svn_dist() {
	if [ "$3" ]; then
		SVN_REVISION=$3
	fi
	
	echo -en "REV $SVN_REVISION: Downloading code..."
	svn export http://svn.ipfire.org/svn/ipfire/trunk ipfire-source/ --force > /dev/null
	evaluate 1
	
	echo -en "REV $SVN_REVISION: Fetching changelog..."
	svn log http://svn.ipfire.org/svn/ipfire/trunk -r 1:$SVN_REVISION > ipfire-source/Changelog
	evaluate 1

	echo -en "REV $SVN_REVISION: Compressing files..."
	tar cfj ipfire-source-r$SVN_REVISION.tar.bz2 ipfire-source
	evaluate 1
	
	rm -rf ipfire-source/
}
