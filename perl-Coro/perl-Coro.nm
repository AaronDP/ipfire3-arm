###############################################################################
# IPFire.org    - An Open Source Firewall Solution                            #
# Copyright (C) - IPFire Development Team <info@ipfire.org>                   #
###############################################################################

name       = perl-Coro
version    = 6.49
release    = 1
thisapp    = Coro-%{version}

groups     = Development/Libraries
url        = http://search.cpan.org/dist/Coro/
license    = GPL+ or Artistic
summary    = The only real threads in perl.

description
	This module collection manages continuations in general, most often in the
	form of cooperative threads (also called coros, or simply "coro" in the
	documentation). They are similar to kernel threads but don't (in general) run
	in parallel at the same time even on SMP machines
end

source_dl  = http://search.cpan.org/CPAN/authors/id/M/ML/MLEHMANN/

build
	requires
		coreutils
		findutils
		perl(AnyEvent) >= 7
		perl(AnyEvent::AIO) >= 1
		perl(AnyEvent::BDB) >= 1
		perl(AnyEvent::Socket)
		perl(AnyEvent::Util)
		perl(Canary::Stability)
		perl(Carp)
		perl(Config)
		perl(Errno)
		perl(Exporter)
		perl(EV) >= 4
		perl(EV::MakeMaker)
		perl(Event) >= 1.08
		perl(Event::MakeMaker)
		perl(ExtUtils::MakeMaker) >= 6.52
		perl(Guard) >= 0.5
		perl(IO::Socket::INET)
		perl(Scalar::Util)
		perl(Socket)
		perl(Storable) >= 2.15
		perl(XSLoader)
		perl(base)
		perl(common::sense)
		perl(overload)
		perl(strict)
		perl(warnings)
		pakfire >= 0.9.26-3.1
	end

	prepare_cmds
		# Fix bad path for perl interpreter.
		for F in Coro/jit-*.pl; do
			sed -i -e '/^#!/d' "$F"
		done
	end

	build
		perl Makefile.PL INSTALLDIRS=perl OPTIMIZE="%{CFLAGS}"
		make %{PARALLELISMFLAGS}
	end

	test
		make test
	end

	make_install_targets = \
		pure_install DESTDIR=%{BUILDROOT}
end

packages
	package %{name}
		filter_requires
			AnyEvent
			EV
			Event
			Guard
			Storable
			Coro
		end

		requires
			perl(:MODULE_COMPAT_%{perl_version})
			perl(AnyEvent) >= 7
			perl(AnyEvent::AIO) >= 1
			perl(AnyEvent::BDB) >= 1
			perl(EV) >= 4
			perl(Event) >= 1.08
			perl(Guard) >= 0.5
			perl(Storable) >= 2.15
			perl(warnings)
		end
	end

	package %{name}-debuginfo
		template DEBUGINFO
	end
end
