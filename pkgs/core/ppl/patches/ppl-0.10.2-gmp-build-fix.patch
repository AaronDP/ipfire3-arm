X-Git-Url: http://www.cs.unipr.it/git/gitweb.cgi?p=ppl%2Fppl.git;a=blobdiff_plain;f=m4%2Fac_check_gmp.m4;h=15acb182ed2d386e899fcdf6eeb9ea5b8fb3b90c;hp=4dc3bc84e978da109e08c4d64d6551535f2eef4b;hb=refs%2Fheads%2Fpip;hpb=5596eca02f2dea09e57ea22a240c2f3eab8be9e5

diff --git a/m4/ac_check_gmp.m4 b/m4/ac_check_gmp.m4
index 4dc3bc8..15acb18 100644
--- a/m4/ac_check_gmp.m4
+++ b/m4/ac_check_gmp.m4
@@ -1,5 +1,5 @@
 dnl A function to check for the existence and usability of GMP.
-dnl Copyright (C) 2001-2009 Roberto Bagnara <bagnara@cs.unipr.it>
+dnl Copyright (C) 2001-2010 Roberto Bagnara <bagnara@cs.unipr.it>
 dnl
 dnl This file is part of the Parma Polyhedra Library (PPL).
 dnl
@@ -32,6 +32,23 @@ else
   fi
 fi
 
+AC_ARG_WITH(gmp-build,
+  AS_HELP_STRING([--with-gmp-build=DIR],
+                 [use a non-installed build of GMP in DIR]),
+  gmp_build_dir=$with_gmp_build
+  if test -z "$with_libgmp_prefix"
+  then
+    CPPFLAGS="$CPPFLAGS -I$gmp_build_dir -I$gmp_build_dir/tune"
+    LDFLAGS="$LDFLAGS -L$gmp_build_dir -L$gmp_build_dir/.libs"
+    LDFLAGS="$LDFLAGS -L$gmp_build_dir/tune"
+  else
+    AC_MSG_ERROR([cannot use --with-gmp-build and --with-gmp-prefix together])
+  fi)
+
+dnl Both libgmp and libbmpxx come from the gmp package.
+AC_LIB_FROMPACKAGE([gmp], [gmp])
+AC_LIB_FROMPACKAGE([gmpxx], [gmp])
+
 dnl Check how to link with libgmp.
 AC_LIB_LINKFLAGS([gmp])
 
@@ -54,6 +71,10 @@ AC_RUN_IFELSE([AC_LANG_SOURCE([[
 #GMP version 4.1.3 or higher is required
 #endif
 
+#ifndef BITS_PER_MP_LIMB
+#define BITS_PER_MP_LIMB GMP_LIMB_BITS
+#endif
+
 int
 main() {
   std::string header_version;
@@ -80,11 +101,11 @@ main() {
     return 1;
   }
 
-  if (sizeof(mp_limb_t)*CHAR_BIT != GMP_LIMB_BITS
-      || GMP_LIMB_BITS != mp_bits_per_limb) {
+  if (sizeof(mp_limb_t)*CHAR_BIT != BITS_PER_MP_LIMB
+      || BITS_PER_MP_LIMB != mp_bits_per_limb) {
     std::cerr
       << "GMP header (gmp.h) and library (ligmp.*) bits-per-limb mismatch:\n"
-      << "header gives " << __GMP_BITS_PER_MP_LIMB << ";\n"
+      << "header gives " << BITS_PER_MP_LIMB << ";\n"
       << "library gives " << mp_bits_per_limb << ".\n"
       << "This probably means you are on a bi-arch system and\n"
       << "you are compiling with the wrong header or linking with\n"
