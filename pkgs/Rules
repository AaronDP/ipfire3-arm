
## XXX FIX THIS
include $(dir $(word $(words $(MAKEFILE_LIST)),$(MAKEFILE_LIST)))/gmsl

STAGE_PACKAGE_TARGETS = $(call reverse,$(PKG_PACKAGES))
STAGE_DONE = $(ROOT)/.done

info:
	@echo "PKG_BUILD_DEPENDENCIES=\"$(PKG_BUILD_DEPS)\""
	@echo "PKG_DEPENDENCIES=\"$(PKG_DEPS)\""
	@echo "PKG_DESCRIPTION=\"$(strip $(PKG_DESCRIPTION))\""
	@echo "PKG_GROUP=\"$(PKG_GROUP)\""
	@echo "PKG_LICENSE=\"$(PKG_LICENSE)\""
	@echo "PKG_MAINTAINER=\"$(PKG_MAINTAINER)\""
	@echo "PKG_NAME=\"$(PKG_NAME_REAL)\""
	@echo "PKG_OBJECTS=\"$(strip $(PKG_OBJECTS))\""
	@echo "PKG_PACKAGES=\"$(PKG_PACKAGES)\""
	@echo "PKG_PACKAGES_FILES=\"$(PKG_PACKAGES_FILES)\""
	@echo "PKG_VER=\"$(PKG_VER)\""
	@echo "PKG_REL=\"$(PKG_REL)\""
	@echo "PKG_SUMMARY=\"$(strip $(PKG_SUMMARY))\""
	@echo "PKG_URL=\"$(PKG_URL)\""
ifeq "$(TOOLCHAIN)" "1"
	@echo "PKG_TOOLCHAIN_DEPS=\"$(PKG_TOOLCHAIN_DEPS)\""
endif

$(OBJECTS):
	@echo "Object file \"$@\" is required." >&2
	@exit 1

$(STAGE_PACKAGE_TARGETS): $(STAGE_DONE)
	@echo "$(strip $(PKG_FILES_$@))" > $(DIR_TMP)/filelist_$@
	@/usr/src/src/pakfire/compressor $(DIR_PACKAGES)/$(call DO_PACKAGE_FILENAME,$@) \
		--root=$(BUILDROOT) $(if $(PKG_FILES_$@), --regexes=$(DIR_TMP)/filelist_$@)

package: $(STAGE_PACKAGE_TARGETS)

shell: $(OBJECTS)
	$(if $(STAGE_PREPARE),$(DO_PREPARE))

$(STAGE_DONE): $(OBJECTS)
	$(if $(STAGE_PREPARE),$(DO_PREPARE))
	$(if $(STAGE_BUILD),$(DO_BUILD))
	$(if $(STAGE_INSTALL),$(DO_INSTALL))
	@touch $@
